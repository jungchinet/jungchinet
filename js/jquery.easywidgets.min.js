/**
 * Easy Widgets jQuery plugin 1.4
 * David Esperalta - http://www.davidesperalta.com/
 */
(function(b){b.fn.EasyWidgets=function(B){var u=b.extend(true,b.fn.EasyWidgets.defaults,B);b(u.selectors.editbox).hide();var n='<span class="'+u.selectors.widgetMenu.replace(/\./,"")+'"></span>';b(n).appendTo(u.selectors.header,this);var d=new Array();b(u.selectors.widget).each(function(G){var j="";var J=b(this);var F=J.attr("id");var i=J.find(u.selectors.widgetMenu);var D=J.find(u.selectors.content);var s=(F&&u.behaviour.useCookies&&b.cookie);if(F){d[G]=F}if(s&&b.cookie(u.cookies.closeName)){j=b.cookie(u.cookies.closeName);if(j.indexOf(F)!=-1){J.hide()}}var H="";if(J.hasClass(u.options.collapsable)){if(J.hasClass(u.options.collapse)){H=c(u.i18n.extendText,u.i18n.extendTitle,u.selectors.collapseLink);D.hide()}else{H=c(u.i18n.collapseText,u.i18n.collapseTitle,u.selectors.collapseLink)}if(s){j=b.cookie(u.cookies.collapseName);if(j){if(j.indexOf(F)!=-1){H=c(u.i18n.extendText,u.i18n.extendTitle,u.selectors.collapseLink);D.hide()}}}b(H).mousedown(function(K){K.stopPropagation()}).click(function(){var R=b(this);var M=true;var O=true;var Q=R.parents(u.selectors.widget);var N=Q.attr("id");var L=Q.find(u.selectors.content);var P=L.css("display")!="none";var S=N&&u.behaviour.useCookies&&b.cookie;R.blur();if(P){if(b.isFunction(u.callbacks.onCollapseQuery)){O=u.callbacks.onCollapseQuery(R,Q)}if(O){a(L,u.effects.widgetCollapse,u.effects.effectDuration,false);R.html(u.i18n.extendText);R.attr("title",u.i18n.extendTitle);if(S){var K=b.cookie(u.cookies.collapseName);if(!K){K=N}else{if(K.indexOf(N)==-1){K=K+","+N}}b.cookie(u.cookies.collapseName,K,{path:u.cookies.path,secure:u.cookies.secure,domain:u.cookies.domain,expires:u.cookies.expires})}if(b.isFunction(u.callbacks.onCollapse)){u.callbacks.onCollapse(R,Q)}}}else{if(b.isFunction(u.callbacks.onExtendQuery)){M=u.callbacks.onExtendQuery(R,Q)}if(M){R.html(u.i18n.collapseText);R.attr("title",u.i18n.collapseTitle);a(L,u.effects.widgetExtend,u.effects.effectDuration,true);if(S){K=b.cookie(u.cookies.collapseName);if(K.indexOf(N)!=-1){K=K.replace(","+N,"");K=K.replace(N+",","");K=K.replace(N,"")}b.cookie(u.cookies.collapseName,K,{path:u.cookies.path,secure:u.cookies.secure,domain:u.cookies.domain,expires:u.cookies.expires})}if(b.isFunction(u.callbacks.onExtend)){u.callbacks.onExtend(R,Q)}}}return false}).appendTo(b(i,this))}var E="";if(J.hasClass(u.options.editable)){E=c(u.i18n.editText,u.i18n.editTitle,u.selectors.editLink);J.find(u.selectors.closeEdit).click(function(O){var M=b(this);var N=M.parents(u.selectors.widget);var K=N.find(u.selectors.editLink);var L=N.find(u.selectors.editbox);M.blur();a(L,u.effects.widgetCloseEdit,u.effects.effectDuration,false);K.html(u.i18n.editText);K.attr("title",u.i18n.editTitle);return false});b(E).mousedown(function(K){K.stopPropagation()}).click(function(){var K=true;var L=true;var N=b(this);var P=N.parents(u.selectors.widget);var M=P.find(u.selectors.editbox);var O=M.css("display")!="none";N.blur();if(O){if(b.isFunction(u.callbacks.onCancelEditQuery)){L=u.callbacks.onCancelEditQuery(N,P)}if(L){a(M,u.effects.widgetCancelEdit,u.effects.effectDuration,false);N.html(u.i18n.editText);N.attr("title",u.i18n.editTitle);if(b.isFunction(u.callbacks.onCancelEdit)){u.callbacks.onCancelEdit(N,P)}}}else{if(b.isFunction(u.callbacks.onEditQuery)){K=u.callbacks.onEditQuery(N,P)}if(K){N.html(u.i18n.cancelEditText);N.attr("title",u.i18n.cancelEditTitle);a(M,u.effects.widgetOpenEdit,u.effects.effectDuration,true);if(b.isFunction(u.callbacks.onEdit)){u.callbacks.onEdit(N,P)}}}return false}).appendTo(b(i,this))}var I="";if(J.hasClass(u.options.removable)){I=c(u.i18n.closeText,u.i18n.closeTitle,u.selectors.closeLink);b(I).mousedown(function(K){K.stopPropagation()}).click(function(){var O=true;var L=b(this);var M=L.parents(u.selectors.widget);var K=M.attr("id");var P=(K&&u.behaviour.useCookies&&b.cookie);L.blur();if(b.isFunction(u.callbacks.onCloseQuery)){O=u.callbacks.onCloseQuery(L,M)}if(O){if(!M.hasClass(u.options.closeConfirm)||confirm(u.i18n.confirmMsg)){if(P){var N=b.cookie(u.cookies.closeName);if(!N){N=K}else{if(N.indexOf(K)==-1){N=N+","+K}}b.cookie(u.cookies.closeName,N,{path:u.cookies.path,secure:u.cookies.secure,domain:u.cookies.domain,expires:u.cookies.expires})}a(M,u.effects.widgetClose,u.effects.effectDuration,false);if(b.isFunction(u.callbacks.onClose)){u.callbacks.onClose(L,M)}}}return false}).appendTo(b(i,this))}});var y,x=0;var h="";var p=u.behaviour.useCookies&&b.cookie;if(b.isFunction(u.callbacks.onRefreshPositions)){h=u.callbacks.onRefreshPositions()}else{if(p&&b.cookie(u.cookies.positionName)){h=b.cookie(u.cookies.positionName)}}if(b.trim(h)!=""){y=x=0;var f=h.split("|");var C=f.length;for(y=0;y<C;y++){var l=f[y].split("=");var e="#"+l[0];if(b(e)){var w=l[1].split(",");var t=w.length;for(x=0;x<t;x++){if(b.trim(w[x])!=""){var r="#"+w[x];b(r).appendTo(e)}}}}}var g=null;g=(function(){var i="";b(u.selectors.widget).each(function(j){if(!b(this).hasClass(u.options.movable)){if(!this.id){this.id="widget-without-id-"+j}i+="#"+this.id+","}});return b("> "+u.selectors.container+":not("+i+")",u.selectors.columns)})();g.find(u.selectors.header).css({cursor:"move"}).mousedown(function(i){var j=b(this);g.css({width:""});j.parent().css({width:j.parent().width()+"px"})}).mouseup(function(){var i=b(this);if(!i.parent().hasClass("dragging")){i.parent().css({width:""})}else{b(u.selectors.columns).sortable("disable")}});b(u.selectors.columns).sortable({items:g,containment:"document",forcePlaceholderSize:true,handle:u.selectors.header,delay:u.behaviour.dragDelay,revert:u.behaviour.dragRevert,opacity:u.behaviour.dragOpacity,connectWith:b(u.selectors.columns),placeholder:u.selectors.placeHolder,start:function(j,i){b(i.helper).addClass("dragging")},stop:function(E,D){b(D.item).css({width:""}).removeClass("dragging");b(u.selectors.columns).sortable("enable");var i="";var s=D.item[0].id;var j=s&&u.behaviour.useCookies&&b.cookie;b(u.selectors.columns).each(function(G){var F=this;var H="";var I=F.id+"=";b(F).children(u.selectors.widget).each(function(J){var K=this;if(H==""){H+=K.id}else{H+=","+K.id}});I+=H;if(i==""){i+=I}else{i+="|"+I}});if(b.isFunction(u.callbacks.onChangePositions)){u.callbacks.onChangePositions(i)}else{if(j){if(b.cookie(u.cookies.positionName)!=i){b.cookie(u.cookies.positionName,i,{path:u.cookies.path,secure:u.cookies.secure,domain:u.cookies.domain,expires:u.cookies.expires})}}}if(b.isFunction(u.callbacks.onDragStop)){u.callbacks.onDragStop(E,D)}return true}});var q=p&&(d.length>0)&&(Math.ceil(Math.random()*3)==1);if(q){y=x=0;var m=new Array(u.cookies.closeName,u.cookies.collapseName);var z=m.length;for(y=0;y<z;y++){if(b.cookie(m[y])){var A="";var o="";var k=b.cookie(m[y]).split(",");var v=k.length;for(x=0;x<v;x++){A=b.trim(k[x]);if(b.inArray(A,d)!=-1){if(b.trim(o)==""){o+=A}else{o+=","+A}}}b.cookie(m[y],o,{path:u.cookies.path,secure:u.cookies.secure,domain:u.cookies.domain,expires:u.cookies.expires})}}}};b.fn.DisableEasyWidgets=function(f){var d=true;var e=b.extend(true,b.fn.EasyWidgets.defaults,f);if(b.isFunction(e.callbacks.onDisableQuery)){d=e.callbacks.onDisableQuery()}if(d){b(e.selectors.columns).sortable("disable");b(e.selectors.widget).each(function(){var g=b(this);if(g.hasClass(e.options.movable)){g.find(e.selectors.header).css("cursor","default")}});if(b.isFunction(e.callbacks.onDisable)){e.callbacks.onDisable()}return true}else{return false}};b.fn.EnableEasyWidgets=function(f){var d=true;var e=b.extend(true,b.fn.EasyWidgets.defaults,f);if(b.isFunction(e.callbacks.onEnableQuery)){d=e.callbacks.onEnableQuery()}if(d){b(e.selectors.columns).sortable("enable");b(e.selectors.widget).each(function(){var g=b(this);if(g.hasClass(e.options.movable)){g.find(e.selectors.header).css("cursor","move")}});if(b.isFunction(e.callbacks.onEnable)){e.callbacks.onEnable()}return true}else{return false}};b.fn.ShowEasyWidget=function(j,e){var g="#"+j;var f=b(g);var d=b.extend(true,b.fn.EasyWidgets.defaults,e);a(f,d.effects.widgetShow,d.effects.effectDuration,true);if(d.behaviour.useCookies){var i=d.cookies.closeName;var h=b.cookie(i);if(h!=""){h=h.replace(","+j,"");h=h.replace(j+",","");h=h.replace(j,"")}b.cookie(i,h,{path:d.cookies.path,expires:d.cookies.expires})}return true};b.fn.HideEasyWidget=function(j,e){var g="#"+j;var f=b(g);var d=b.extend(true,b.fn.EasyWidgets.defaults,e);a(f,d.effects.widgetHide,d.effects.effectDuration,false);if(d.behaviour.useCookies){var i=d.cookies.closeName;var h=b.cookie(i);if(!h){h=j}else{if(h.indexOf(j)==-1){h=h+","+j}}b.cookie(i,h,{path:d.cookies.path,expires:d.cookies.expires})}return true};b.fn.EasyWidgets.defaults={behaviour:{dragDelay:100,dragRevert:100,dragOpacity:0.8,useCookies:false},effects:{effectDuration:500,widgetShow:"none",widgetHide:"none",widgetClose:"none",widgetExtend:"none",widgetCollapse:"none",widgetOpenEdit:"none",widgetCloseEdit:"none",widgetCancelEdit:"none"},cookies:{path:"",domain:"",expires:90,secure:false,closeName:"easywidgets-close",positionName:"easywidgets-position",collapseName:"easywidgets-collapse"},options:{movable:"movable",editable:"editable",collapse:"collapse",removable:"removable",collapsable:"collapsable",closeConfirm:"closeconfirm"},callbacks:{onEdit:null,onClose:null,onEnable:null,onExtend:null,onDisable:null,onDragStop:null,onCollapse:null,onEditQuery:null,onCloseQuery:null,onCancelEdit:null,onEnableQuery:null,onExtendQuery:null,onDisableQuery:null,onCollapseQuery:null,onCancelEditQuery:null,onChangePositions:null,onRefreshPositions:null},selectors:{container:"div",widget:".widget",header:".widget-header",widgetMenu:".widget-menu",columns:".widget-column",editbox:".widget-editbox",content:".widget-content",closeEdit:".widget-close-editbox",editLink:".widget-editlink",closeLink:".widget-closelink",placeHolder:"widget-placeholder",collapseLink:".widget-collapselink"},i18n:{editText:"Edit",closeText:"Close",extendText:"Extend",collapseText:"Collapse",cancelEditText:"Cancel",editTitle:"Edit this widget",closeTitle:"Close this widget",confirmMsg:"Remove this widget?",cancelEditTitle:"Cancel edition",extendTitle:"Extend this widget",collapseTitle:"Collapse this widget"}};function c(g,f,e){var d='<a href="#" title="TITLE" class="CLASS">TEXT</a>';d=d.replace(/TEXT/g,g);d=d.replace(/TITLE/g,f);d=d.replace(/CLASS/g,e.replace(/\./,""));return d}function a(e,h,j,d){var k="none",i="fade",g="slide";if(!d){if(h==k){e.hide()}else{if(h==i){e.fadeOut(j)}else{if(h==g){e.slideUp(j)}}}}else{if(h==k){e.show()}else{if(h==i){e.fadeIn(j)}else{if(h==g){e.slideDown(j)}}}}return true}})(jQuery);
